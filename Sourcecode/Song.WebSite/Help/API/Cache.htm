<!DOCTYPE html>
<html lang="en">

<head resource>
    <meta charset="utf-8">
    <meta view="cache" page="/Help/API/cache.htm" />
    <title>缓存策略的说明</title>
    <script type="text/javascript" src="/Utilities/Scripts/webdom.js"></script>
    <script type="text/javascript" src="../Scripts/core.js"></script>
</head>

<body>

    <p>采用浏览器本地数据库(IndexedDB)存储接口数据，当接口与参数相同的$api.cache请求，在限定时效内将不再请求网络。</p>
    <p>如果缓存不存在，则自动取服务器端的数据，此时$api.cache等同于$api.get方法。</p>
    <p>只有接口支持HttpGET方法时，才可以在前端使用$api.cache请求，HttpPost、HttpDelete不支持$api.cache请求。</p>
    <pre class="line-numbers"><code class="language-javascript">   
    //缓存20分钟，数值可以为空，默认是10分钟
    $api.cache('News/Article:20',{ 'id': 225 }).then(req=>{
        if(req.data.success){
            let result=req.data.result;
            //...
        }else{
            throw req.data.message;
        }
    }).catch(err=>console.error(err))
        .finally(()=>{});
            
     </code></pre>
    <p>缓存的更新</p>
    <pre class="line-numbers"><code class="language-javascript">
    //更新缓存
    $api.cache('News/Article:update',{'id':'1'});
    //清除缓存
    $api.cache('News/Article:clear',{'id':'1'});
    //强制缓存20分钟 （当禁用缓存时，通过加号，强制使用缓存）
    $api.cache('News/Article:+20',{'id':'1'});
            </code></pre>

    <p>缓存的清理与重置</p>
    <pre class="line-numbers"><code class="language-javascript">  
    //清理过期缓存，包括被强制缓存的数据
    $api.api_cache.clear();
    //清除所有缓存，包括被强制缓存的数据
    $api.api_cache.reset();
    </code></pre>
    <p>&nbsp;</p>
</body>

</html>